import { extractJson } from '../utils/structured-output/index.js';
export function extractJsonMiddleware(options = {}) {
    return {
        name: 'extractJson',
        transformResult: (result) => {
            const extracted = extractJson(result.output);
            if (!extracted) {
                return result;
            }
            const transformed = options.transform ? options.transform(extracted) : extracted;
            if (result.structured === undefined) {
                try {
                    const parsed = JSON.parse(transformed);
                    return {
                        ...result,
                        output: transformed,
                        structured: parsed,
                    };
                }
                catch {
                    return {
                        ...result,
                        output: transformed,
                    };
                }
            }
            return {
                ...result,
                output: transformed,
            };
        },
    };
}
//# sourceMappingURL=extract-json.js.map