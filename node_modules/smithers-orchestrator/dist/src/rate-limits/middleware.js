import { ThrottleController } from './throttle.js';
export function rateLimitingMiddleware(options) {
    const controller = new ThrottleController(options.monitor, options.throttle);
    const getProvider = options.modelToProvider ?? (() => 'anthropic');
    return {
        name: 'rate-limiting',
        wrapExecute: async ({ doExecute, options: execOptions }) => {
            const model = execOptions.model ?? 'sonnet';
            const provider = getProvider(model);
            const delayMs = await controller.acquire(provider, model);
            if (delayMs > 0) {
                console.log(`[rate-limit] Delayed ${delayMs}ms for ${provider}/${model}`);
            }
            return doExecute();
        },
    };
}
//# sourceMappingURL=middleware.js.map