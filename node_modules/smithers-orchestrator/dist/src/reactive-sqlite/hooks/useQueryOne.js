/**
 * useQueryOne hook for reactive SQLite single-row queries
 */
import { useQuery } from './useQuery.js';
import { useDatabaseOptional } from './context.js';
/**
 * Hook to get a single row from a query
 *
 * @example
 * ```tsx
 * // With explicit db
 * function UserProfile({ userId }: { userId: number }) {
 *   const { data: user } = useQueryOne(
 *     db,
 *     'SELECT * FROM users WHERE id = ?',
 *     [userId]
 *   )
 *
 *   if (!user) return <div>User not found</div>
 *
 *   return <div>{user.name}</div>
 * }
 *
 * // With context (inside DatabaseProvider)
 * function UserProfile({ userId }: { userId: number }) {
 *   const { data: user } = useQueryOne<User>(
 *     'SELECT * FROM users WHERE id = ?',
 *     [userId]
 *   )
 *   return user ? <div>{user.name}</div> : <div>User not found</div>
 * }
 * ```
 */
export function useQueryOne(sqlOrDb, sqlOrParams, paramsOrOptions, optionsOrDb) {
    // Parse overloaded arguments
    const contextDb = useDatabaseOptional();
    let db;
    let sql;
    let params;
    let options;
    if (typeof sqlOrDb === 'string') {
        // New signature: useQueryOne(sql, params?, optionsOrDb?, db?)
        sql = sqlOrDb;
        // Helper to detect ReactiveDatabase (has subscribe method)
        const isDb = (obj) => obj !== null && typeof obj === 'object' && 'subscribe' in obj && typeof obj.subscribe === 'function';
        if (Array.isArray(sqlOrParams)) {
            // useQueryOne(sql, params, ...) - 3rd arg could be options or db
            params = sqlOrParams;
            if (isDb(paramsOrOptions)) {
                options = {};
                db = paramsOrOptions;
            }
            else {
                options = paramsOrOptions ?? {};
                db = isDb(optionsOrDb) ? optionsOrDb : contextDb;
            }
        }
        else {
            // useQueryOne(sql) or useQueryOne(sql, options) or useQueryOne(sql, db)
            params = [];
            if (isDb(sqlOrParams)) {
                options = {};
                db = sqlOrParams;
            }
            else {
                options = sqlOrParams ?? {};
                db = isDb(paramsOrOptions) ? paramsOrOptions : contextDb;
            }
        }
        if (!db) {
            throw new Error('useQueryOne requires either a DatabaseProvider or an explicit db argument');
        }
    }
    else {
        // Legacy signature: useQueryOne(db, sql, params?, options?)
        db = sqlOrDb;
        sql = sqlOrParams;
        params = Array.isArray(paramsOrOptions) ? paramsOrOptions : [];
        options = optionsOrDb ?? {};
    }
    const result = useQuery(db, sql, params, options);
    return {
        ...result,
        data: result.data[0] ?? null,
    };
}
//# sourceMappingURL=useQueryOne.js.map