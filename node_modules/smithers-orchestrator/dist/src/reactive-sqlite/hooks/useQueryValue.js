/**
 * useQueryValue hook for reactive SQLite single-value queries
 */
import { useQuery } from './useQuery.js';
import { useDatabaseOptional } from './context.js';
/**
 * Hook to get a single value from a query
 *
 * @example
 * ```tsx
 * // With explicit db
 * function UserCount() {
 *   const { data: count } = useQueryValue<number>(
 *     db,
 *     'SELECT COUNT(*) as count FROM users'
 *   )
 *
 *   return <div>Total users: {count ?? 0}</div>
 * }
 *
 * // With context (inside DatabaseProvider)
 * function UserCount() {
 *   const { data: count } = useQueryValue<number>('SELECT COUNT(*) as count FROM users')
 *   return <div>Total users: {count ?? 0}</div>
 * }
 * ```
 */
export function useQueryValue(sqlOrDb, sqlOrParams, paramsOrOptions, optionsOrDb) {
    // Parse overloaded arguments
    const contextDb = useDatabaseOptional();
    let db;
    let sql;
    let params;
    let options;
    if (typeof sqlOrDb === 'string') {
        // New signature: useQueryValue(sql, params?, optionsOrDb?, db?)
        sql = sqlOrDb;
        // Helper to detect ReactiveDatabase (has subscribe method)
        const isDb = (obj) => obj !== null && typeof obj === 'object' && 'subscribe' in obj && typeof obj.subscribe === 'function';
        if (Array.isArray(sqlOrParams)) {
            // useQueryValue(sql, params, ...) - 3rd arg could be options or db
            params = sqlOrParams;
            if (isDb(paramsOrOptions)) {
                options = {};
                db = paramsOrOptions;
            }
            else {
                options = paramsOrOptions ?? {};
                db = isDb(optionsOrDb) ? optionsOrDb : contextDb;
            }
        }
        else {
            // useQueryValue(sql) or useQueryValue(sql, options) or useQueryValue(sql, db)
            params = [];
            if (isDb(sqlOrParams)) {
                options = {};
                db = sqlOrParams;
            }
            else {
                options = sqlOrParams ?? {};
                db = isDb(paramsOrOptions) ? paramsOrOptions : contextDb;
            }
        }
        if (!db) {
            throw new Error('useQueryValue requires either a DatabaseProvider or an explicit db argument');
        }
    }
    else {
        // Legacy signature: useQueryValue(db, sql, params?, options?)
        db = sqlOrDb;
        sql = sqlOrParams;
        params = Array.isArray(paramsOrOptions) ? paramsOrOptions : [];
        options = optionsOrDb ?? {};
    }
    const result = useQuery(db, sql, params, options);
    const firstRow = result.data[0];
    const value = firstRow ? Object.values(firstRow)[0] ?? null : null;
    return {
        ...result,
        data: value,
    };
}
//# sourceMappingURL=useQueryValue.js.map